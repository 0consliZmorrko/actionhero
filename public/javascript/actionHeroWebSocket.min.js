!function(a){var b=function(a,b){var c=this;null==b&&"function"==typeof a&&(b=a,a=null),c.callbacks={},c.id=null,c.events={},c.state="disconnected",c.options=c.defaults();for(var d in a)c.options[d]=a[d];c.faye=a&&null!=a.faye?a.faye:null!=window.Faye?window.Faye:Faye};b.prototype.defaults=function(){var a;return"undefined"!=typeof window&&(a=window.location.origin),{host:a,path:"/faye",setupChannel:"/_welcome",channelPrefix:"/client/websocket/connection/",apiPath:"/api",connectionDelay:500,timeout:60,retry:10}},b.prototype.log=function(a){if(console&&console.log){"string"!=typeof a&&(a=JSON.stringify(a));var b=new Date,c=[b.getHours().toString(),b.getMinutes().toString(),b.getSeconds().toString()];for(var d in c)c[d].length<2&&(c[d]="0"+c[d]);console.log("[AH::client @ "+c.join(":")+"] "+a)}},b.prototype.connect=function(a){var b=this;b.startupCallback=a,b.client=new b.faye.Client(b.options.host+b.options.path,{retry:b.options.retry,timeout:b.options.timeout}),b.channel=b.options.channelPrefix+b.createUUID(),b.subscription=b.client.subscribe(b.channel,function(a){b.handleMessage(a)}),b.client.on("transport:down",function(){b.state="reconnecting","disconnect"==typeof b.events.connect&&b.events.disconnect("connected")}),b.client.on("transport:up",function(){var a=b.state;b.state="connected",b.setupConnection(function(c){"reconnecting"==a&&"function"==typeof b.events.reconnect?b.events.reconnect("reconnected"):("function"==typeof b.events.connect&&b.events.connect("connected"),b.completeConnect(c))})})},b.prototype.setupConnection=function(a){var b=this;b.messageCount=0,setTimeout(function(){b.detailsView(function(c){null!=b.room&&b.send({event:"roomChange",room:b.room}),b.id=c.data.id,a(c)})},b.options.connectionDelay)},b.prototype.completeConnect=function(a){var b=this;"function"==typeof b.startupCallback&&b.startupCallback(null,a)},b.prototype.send=function(a,b){var c=this;"connected"==c.state?(c.messageCount++,"function"==typeof b&&(c.callbacks[c.messageCount]=b),c.client.publish(c.channel,a).errback(function(a){c.log(a)})):"function"==typeof b&&b({error:"not connected",state:c.state})},b.prototype.handleMessage=function(a){var b=this;"response"===a.context?("function"==typeof b.callbacks[a.messageCount]&&b.callbacks[a.messageCount](a),delete b.callbacks[a.messageCount]):"user"===a.context?"function"==typeof b.events.say&&b.events.say(a):"alert"===a.context?"function"==typeof b.events.api&&b.events.api(a):null!=a.welcome&&"api"==a.context?(b.welcomeMessage=a.welcome,"function"==typeof b.events.say&&"function"==typeof b.events.welcome&&b.events.welcome(a)):"api"===a.context&&"function"==typeof b.events.api&&b.events.api(a)},b.prototype.createUUID=function(){for(var a=[],b="0123456789abcdef",c=0;36>c;c++)a[c]=b.substr(Math.floor(16*Math.random()),1);return a[14]="4",a[19]=b.substr(3&a[19]|8,1),a[8]=a[13]=a[18]=a[23]="-",a.join("")},b.prototype.action=function(a,b,c){null==c&&"function"==typeof b&&(c=b,b=null),null==b&&(b={}),b.action=a,this.send({event:"action",params:b},c)},b.prototype.say=function(a,b){this.send({event:"say",message:a},b)},b.prototype.detailsView=function(a){this.send({event:"detailsView"},a)},b.prototype.roomView=function(a){this.send({event:"roomView"},a)},b.prototype.roomChange=function(a,b){this.room=a,this.send({event:"roomChange",room:a},b)},b.prototype.roomLeave=function(a){this.send({event:"roomLeave"},a)},b.prototype.listenToRoom=function(a,b){this.send({event:"listenToRoom",room:a},b)},b.prototype.silenceRoom=function(a,b){this.send({event:"silenceRoom",room:a},b)},b.prototype.documentation=function(a){this.send({event:"documentation"},a)},b.prototype.disconnect=function(){this.state="disconnected",this.client.disconnect()},a.actionHeroWebSocket=b}("undefined"==typeof exports?window:exports);